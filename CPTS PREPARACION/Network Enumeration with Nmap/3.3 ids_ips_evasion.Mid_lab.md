# Firewall and IDS/IPS Evasion â€“ Medium Lab

## ğŸ¯ Objetivo del laboratorio
El reto consiste en enfrentarnos a un sistema protegido por un **firewall** y un **IDS/IPS**, que filtran y monitorizan el trÃ¡fico. Nuestro cliente quiere saber si es posible **identificar la versiÃ³n del servidor DNS** que corre en la mÃ¡quina objetivo (`10.129.2.48`) pese a estas medidas defensivas.

La pregunta a responder es:

> **Â¿Es posible encontrar la versiÃ³n del servidor DNS del target?**  
> â†’ Debemos enviar la versiÃ³n (banner) del servicio como respuesta.

---

## ğŸ›¡ï¸ Contexto: Â¿QuÃ© es IDS/IPS Evasion?
Un **IDS/IPS (Intrusion Detection/Prevention System)** es un sistema que detecta (y en el caso del IPS tambiÃ©n bloquea) trÃ¡fico sospechoso en la red.  
Normalmente reacciona ante:
- **Patrones de escaneo rÃ¡pidos** (ej: Nmap default con muchos puertos a la vez).  
- **Consultas poco comunes** (ej: `version.bind`).  
- **Comportamiento anÃ³malo** (ej: mismo host enviando demasiados paquetes seguidos).  

Nuestro objetivo es **disfrazar el escaneo** para que el IDS/IPS lo vea como trÃ¡fico legÃ­timo.

---

## âš™ï¸ MetodologÃ­a y comandos usados

### 1. Primer intento: escaneo directo
```bash
sudo nmap -sV -sU -p 53 10.129.2.48
```

ğŸ“Œ **Resultado:**  
Se obtuvo un banner con la versiÃ³n del servidor DNS:

```
53/udp open  domain  (unknown banner: HTB{xxxxxxx})
```

ğŸ‘‰ AquÃ­ ya tenemos la **respuesta final del lab**:  
`HTB{GoTtgUnyze9Psw4vGjcuMpHRp}`  

---

### 2. TÃ©cnica: Source Port Spoofing
```bash
sudo nmap -sU -p 53 --source-port 53 -sV 10.129.2.48
```

ğŸ“Œ **Resultado:**  
El banner se obtiene igualmente, pero con **menos alarmas** en el IDS.

---

### 3. TÃ©cnica: Packet Fragmentation
```bash
sudo nmap -sU -p 53 -sV -f 10.129.2.48
```

ğŸ“Œ **Resultado:**  
Se obtiene la misma informaciÃ³n, pero de forma mÃ¡s sigilosa.

---

### 4. TÃ©cnica: Timing mÃ¡s lento
```bash
sudo nmap -sU -p 53 -sV -T2 10.129.2.48
```

ğŸ“Œ **Resultado:**  
Menos alarmas, aunque el escaneo tarda un poco mÃ¡s.

---

## âœ… Respuesta final
La versiÃ³n del servidor DNS (banner capturado) es:

```
HTB{xxxxxxx}
```

---

## ğŸ“š Lecciones aprendidas
1. **Un escaneo directo funciona**, pero genera alertas.  
2. TÃ©cnicas de evasiÃ³n utilizadas:  
   - `--source-port 53` â†’ disimular trÃ¡fico como DNS legÃ­timo.  
   - `-f` â†’ fragmentaciÃ³n para evadir inspecciÃ³n.  
   - `-T2` â†’ timing mÃ¡s lento y menos sospechoso.  
3. **IDS/IPS no son invencibles**: con tÃ©cnicas adecuadas podemos recolectar banners sin ser detectados fÃ¡cilmente.  
4. En un examen real de **CPTS**, lo importante es **demostrar no solo el resultado**, sino tambiÃ©n el entendimiento de las tÃ©cnicas aplicadas.  

---

## ğŸ ConclusiÃ³n
Este laboratorio de nivel medio nos ha permitido practicar **evasiÃ³n de firewalls e IDS/IPS**. Aunque el objetivo era simple (identificar la versiÃ³n del DNS), el valor del ejercicio estÃ¡ en **aprender cÃ³mo disfrazar nuestras herramientas** para que pasen desapercibidas.  

Con esto consolidamos una de las habilidades mÃ¡s valoradas en pentesting real y en exÃ¡menes como **CPTS/OSCP**: **no solo explotar, sino evadir detecciÃ³n.**

---



