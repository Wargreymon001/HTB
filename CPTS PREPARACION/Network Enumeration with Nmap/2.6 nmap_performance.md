
# Nmap - Rendimiento y Timing

## Introducción
El rendimiento del escaneo con **Nmap** es clave cuando trabajamos con redes extensas o conexiones con bajo ancho de banda.  
Podemos ajustar parámetros para **acelerar o ralentizar el escaneo**, controlando tiempos de espera, número de reintentos, frecuencia de envío de paquetes y plantillas de timing.

---

## 1. Timeouts (Tiempos de espera)
Cuando Nmap envía un paquete, tarda un tiempo en recibir respuesta (**RTT – Round Trip Time**).  
Por defecto:
- `--initial-rtt-timeout` = **100ms**
- `--max-rtt-timeout` = tiempo máximo de espera antes de descartar.

### Ejemplo
```bash
# Escaneo normal (red /24, top 100 puertos)
sudo nmap 10.129.2.0/24 -F

# Escaneo optimizado reduciendo los RTT
sudo nmap 10.129.2.0/24 -F --initial-rtt-timeout 50ms --max-rtt-timeout 100ms
```
### Resultados:
- **Normal:** 10 hosts detectados en ~39s  
- **Optimizado:** 8 hosts detectados en ~12s  
⚠️ **Riesgo:** reducir demasiado el RTT puede hacer que perdamos hosts.

---

## 2. Retries (Reintentos)
Por defecto, Nmap hace **10 reintentos** si un puerto no responde.  
Podemos reducir este número con `--max-retries` para acelerar el escaneo.

### Ejemplo
```bash
# Escaneo normal con reintentos
sudo nmap 10.129.2.0/24 -F | grep "/tcp" | wc -l
# → 23 puertos abiertos encontrados

# Escaneo rápido sin reintentos
sudo nmap 10.129.2.0/24 -F --max-retries 0 | grep "/tcp" | wc -l
# → 21 puertos abiertos encontrados
```
⚠️ Riesgo: omitir reintentos puede hacer que se pierdan resultados.

---

## 3. Rates (Velocidad de envío)
Podemos forzar a Nmap a enviar paquetes a cierta tasa con `--min-rate <número>`.  
Esto define el **mínimo de paquetes por segundo** que Nmap intentará mantener.

### Ejemplo
```bash
# Escaneo normal
sudo nmap 10.129.2.0/24 -F -oN tnet.default

# Escaneo optimizado forzando 300 paquetes/segundo
sudo nmap 10.129.2.0/24 -F -oN tnet.minrate300 --min-rate 300
```
### Resultados
- Tiempo normal: ~29s  
- Tiempo optimizado: ~8s  
- **Mismos 23 puertos encontrados.**

---

## 4. Timing Templates (-T)
Nmap trae **plantillas predefinidas de timing** que ajustan automáticamente varios parámetros.  
Van de `-T0` (muy lento, sigiloso) a `-T5` (extremadamente rápido y ruidoso).

| Opción | Nombre     | Uso típico |
|--------|-----------|------------|
| `-T0`  | Paranoid  | Muy sigiloso, evade IDS/IPS |
| `-T1`  | Sneaky    | Escaneo lento, evasión básica |
| `-T2`  | Polite    | Reduce velocidad para no molestar |
| `-T3`  | Normal    | Valor por defecto |
| `-T4`  | Aggressive| Pentesting en LANs rápidas |
| `-T5`  | Insane    | Máxima velocidad, muy ruidoso |

### Ejemplo
```bash
# Escaneo normal
sudo nmap 10.129.2.0/24 -F -oN tnet.default

# Escaneo con T5 (insane)
sudo nmap 10.129.2.0/24 -F -oN tnet.T5 -T 5
```
### Resultados:
- **Normal:** 32s (23 puertos encontrados)  
- **Insane:** 18s (23 puertos encontrados)

⚠️ Riesgo: en entornos con IDS/IPS un `-T4` o `-T5` puede bloquear tu IP.

---

## 5. Conclusiones
- Podemos acelerar el escaneo ajustando **timeouts, retries, rates y timing templates**.  
- **Mayor velocidad** = **mayor riesgo** de perder información o ser detectado.  
- En pentesting real:
  - `-T4` es el más usado en **redes corporativas rápidas**.  
  - `--min-rate` es útil para **scans masivos**.  
  - `-T0` o `-T1` se usan para **evadir detección**.

---

## Laboratorio
### Enunciado
> Ajusta los parámetros de rendimiento de Nmap (timeouts, retries, rates y templates) para comparar resultados y entender el impacto en la velocidad y precisión de los escaneos.

### Objetivo
- Aprender a equilibrar **velocidad vs precisión**.  
- Comprender cómo la configuración influye en el tiempo total y en la detección de hosts/puertos.

---
