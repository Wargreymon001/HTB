# 🧠 Nmap: Descubrimiento de Hosts

## ✅ Conceptos clave
- El primer paso en una auditoría/red interna es detectar qué hosts están activos.
- Nmap permite descubrir hosts vivos con diversas técnicas (ICMP, ARP, etc.).
- Siempre guardar resultados (-oA) para comparación o documentación.
- El método más común es el escaneo ICMP Echo Request (-PE), pero puede verse bloqueado por firewalls.

## 🧪 Modos de escaneo

### 🔍 Rango de red completo
```bash
sudo nmap 10.129.2.0/24 -sn -oA tnet | grep for | cut -d" " -f5
```
- `-sn`: Desactiva escaneo de puertos, solo ping
- `-oA`: Guarda en todos los formatos (`tnet.nmap`, `tnet.gnmap`, `tnet.xml`)

### 📄 Escaneo desde lista de IPs
```bash
sudo nmap -sn -oA tnet -iL hosts.lst | grep for | cut -d" " -f5
```
- `-iL`: Lee las IPs desde un archivo

### ➕ IPs múltiples
```bash
sudo nmap -sn -oA tnet 10.129.2.18 10.129.2.19 10.129.2.20
sudo nmap -sn -oA tnet 10.129.2.18-20
```

### 🎯 IP única
```bash
sudo nmap 10.129.2.18 -sn -oA host
```

## ⚙️ Opciones útiles
```bash
-PE               # Usar ICMP Echo Request (ping)
--packet-trace    # Mostrar todos los paquetes enviados/recibidos
--reason          # Mostrar por qué Nmap considera que el host está vivo
--disable-arp-ping # Desactiva ARP y fuerza uso de ICMP
```

## 🔬 Ejemplo: mostrar paquetes ICMP explícitamente
```bash
sudo nmap 10.129.2.18 -sn -oA host -PE --packet-trace --disable-arp-ping
```

> Nmap prioriza ARP en redes locales. Para obligar ICMP, usa `--disable-arp-ping`.
> Usa `--reason` para ver el motivo de detección de host vivo.

## 📚 Recurso adicional
- [Host Discovery Strategies (nmap.org)](https://nmap.org/book/host-discovery-strategies.html)
