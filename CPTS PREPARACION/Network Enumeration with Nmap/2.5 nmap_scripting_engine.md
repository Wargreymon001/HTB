# üß† Nmap Scripting Engine (NSE)

## ‚úÖ Conceptos clave
- NSE permite usar scripts en **Lua** para interactuar con servicios.
- Los scripts se dividen en **14 categor√≠as** principales:
  - `auth`: autenticaci√≥n
  - `broadcast`: descubrimiento de hosts
  - `brute`: fuerza bruta de credenciales
  - `default`: scripts por defecto (`-sC`)
  - `discovery`: detecci√≥n de servicios accesibles
  - `dos`: pruebas de denegaci√≥n de servicio
  - `exploit`: explotaci√≥n de vulnerabilidades conocidas
  - `external`: uso de servicios externos
  - `fuzzer`: fuzzing de protocolos/servicios
  - `intrusive`: scripts intrusivos
  - `malware`: detecci√≥n de malware
  - `safe`: scripts seguros/no intrusivos
  - `version`: detecci√≥n de versiones
  - `vuln`: identificaci√≥n de vulnerabilidades

## üíª Comandos √∫tiles

### Usar scripts por defecto
```bash
sudo nmap <target> -sC
```

### Ejecutar categor√≠a completa
```bash
sudo nmap <target> --script <category>
```

### Ejecutar scripts espec√≠ficos
```bash
sudo nmap <target> --script script1,script2
```

### Ejemplo especificando scripts (banner + smtp-commands)
```bash
sudo nmap 10.129.2.28 -p 25 --script banner,smtp-commands
```

### Escaneo agresivo
```bash
sudo nmap 10.129.2.28 -p 80 -A
```
Incluye:
- Detecci√≥n de servicios `-sV`
- Detecci√≥n de SO `-O`
- Traceroute `--traceroute`
- Scripts por defecto `-sC`

### Escaneo de vulnerabilidades
```bash
sudo nmap 10.129.2.28 -p 80 -sV --script vuln
```

## üõ†Ô∏è Pasos pr√°cticos / Laboratorio

- **Paso 1: Enumeraci√≥n inicial con escaneo agresivo (`-A`)**.
    
    - Comando utilizado: `sudo nmap -A 10.129.4.47`
        
    - Resultado: Se encontr√≥ un servicio inusual en el puerto **31337** que devolvi√≥ una flag en su banner: `HTB{pr0F7pDv3r510nb4nn3r}`.
        
    - Por qu√© se hizo: El escaneo agresivo es el m√°s completo y a menudo revela informaci√≥n clave como banners de servicios que no se ven en escaneos b√°sicos. Sin embargo, en este caso, la flag result√≥ ser una distracci√≥n.
        
- **Paso 2: Reorientar el ataque seg√∫n la pista**.
    
    - Pista: "Los servidores web se encuentran entre los servicios m√°s atacados..."
        
    - Razonamiento: La pista sugiere que la flag real est√° en el servidor web (puerto 80). El resultado del puerto 31337 era una pista falsa. Se debe escanear el puerto 80 con scripts m√°s detallados.
        
- **Paso 3: Usar `http-enum` para encontrar archivos ocultos**.
    
    - Comando utilizado: `sudo nmap -p 80 --script http-enum 10.129.4.47`
        
    - Resultado: El script encontr√≥ el archivo `/robots.txt`.
        
    - Por qu√© se hizo: El script `http-enum` es ideal para enumerar directorios comunes y archivos que a menudo se utilizan para ocultar informaci√≥n, y `robots.txt` es un lugar habitual para pistas en laboratorios.
        
- **Paso 4: Acceder al archivo descubierto para obtener la flag**.
    
    - Comando utilizado: `curl http://10.129.4.47/robots.txt`
        
    - Resultado: El archivo `/robots.txt` conten√≠a la flag, que deb√≠a enviarse para completar el laboratorio.
        
    - Por qu√© se hizo: Una vez que se descubre un archivo o directorio interesante, se debe acceder a √©l para ver su contenido, ya que la flag suele estar dentro.
## üìå Notas r√°pidas
- `-sC` = default scripts.
- `-A` = agresivo (servicios + OS + traceroute + scripts b√°sicos).
- `--script vuln` = chequear CVEs y problemas de seguridad.
- Usar scripts combinados seg√∫n el servicio encontrado.
