# ğŸ§  Nmap: EnumeraciÃ³n de Servicios

## âœ… Conceptos clave
- Detectar versiones exactas permite buscar exploits o CVEs mÃ¡s precisos.
- Banner grabbing revela versiÃ³n del servicio/sistema operativo.
- La precisiÃ³n mejora al escanear todos los puertos y habilitar `-sV`.

## ğŸ” Comando recomendado
```bash
sudo nmap -p- -sV <IP_objetivo>
```
- `-p-`: escanea todos los puertos
- `-sV`: detecta versiÃ³n de servicios

## ğŸ“Š Monitoreo del progreso
```bash
# Ver estado cada 5 segundos
sudo nmap -p- -sV --stats-every=5s <IP>

# Aumentar verbosidad
sudo nmap -p- -sV -v <IP>
```
Presiona `Espacio` durante el escaneo para ver progreso en tiempo real.

## ğŸ“¥ Resultado tÃ­pico
```text
PORT    STATE SERVICE VERSION
22/tcp  open  ssh     OpenSSH 7.6p1 Ubuntu
25/tcp  open  smtp    Postfix smtpd
80/tcp  open  http    Apache httpd 2.4.29
...
```

## ğŸ“¡ Packet Tracing (opcional)
```bash
sudo nmap -p- -sV -Pn -n --disable-arp-ping --packet-trace <IP>
```

## ğŸ§ª Captura manual de banners
```bash
# Escucha trÃ¡fico
sudo tcpdump -i eth0 host <tu_IP> and <objetivo>

# ConÃ©ctate al puerto manualmente
nc -nv <IP_objetivo> 25
```
- Muchos servicios responden con banners tras el handshake.
- El banner suele indicar nombre, versiÃ³n, incluso SO (`Postfix (Ubuntu)`).

## ğŸ§¬ AnÃ¡lisis del trÃ¡fico (3-way handshake + banner)
1. **SYN** â†’ Cliente inicia conexiÃ³n  
2. **SYN-ACK** â†’ Servidor responde  
3. **ACK** â†’ Cliente confirma  
4. **PSH-ACK** â†’ Servidor envÃ­a banner  
5. **ACK** â†’ Cliente lo confirma

> Este mÃ©todo expone datos que Nmap a veces no interpreta completamente.

## ğŸ“š Recurso adicional
- [Nmap Service Detection Docs](https://nmap.org/book/man-version-detection.html)


# ğŸ§ª Laboratorio: Enumerar puertos y servicios

## ğŸ¯ Objetivo
Enumerar todos los puertos y servicios del objetivo. Uno de los servicios contiene una flag.

## ğŸš€ Pasos realizados
```bash
sudo nmap -p- -sV 10.129.105.112 -oA fullscan
```

## ğŸ” AcciÃ³n posterior
Revisar servicios identificados en el escaneo (`fullscan.nmap`) y conectarse al que contenga contenido visible (como HTTP o SMTP).

Usar:
```bash
curl http://10.129.105.112
# o
nc 10.129.105.112 <puerto>
```

## ğŸ Resultado
La flag se encontrÃ³ directamente en el banner del puerto `31337/tcp`:

```
HTB{pr0F7pDv3r510nb4nn3r}
```

---

## ğŸ§  Nota tÃ©cnica sobre flags en banners

En el laboratorio, la flag fue revelada en el banner de un servicio no reconocido por Nmap (`31337/tcp`).

La teorÃ­a **no lo dice explÃ­citamente**, pero:

- EnseÃ±a a usar `-sV` para obtener banners.
- Muestra ejemplos de servicios que exponen informaciÃ³n al conectarse (como SMTP).
- Advierte que algunos servicios no identificados devuelven datos Ãºtiles.

âœ… **ConclusiÃ³n**: Este tipo de flag se deduce al combinar lo aprendido sobre *banner grabbing*, *servicios no reconocidos* y *anÃ¡lisis manual del resultado*. 
