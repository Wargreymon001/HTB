# 🧠 Nmap: Enumeración de Servicios

## ✅ Conceptos clave
- Detectar versiones exactas permite buscar exploits o CVEs más precisos.
- Banner grabbing revela versión del servicio/sistema operativo.
- La precisión mejora al escanear todos los puertos y habilitar `-sV`.

## 🔍 Comando recomendado
```bash
sudo nmap -p- -sV <IP_objetivo>
```
- `-p-`: escanea todos los puertos
- `-sV`: detecta versión de servicios

## 📊 Monitoreo del progreso
```bash
# Ver estado cada 5 segundos
sudo nmap -p- -sV --stats-every=5s <IP>

# Aumentar verbosidad
sudo nmap -p- -sV -v <IP>
```
Presiona `Espacio` durante el escaneo para ver progreso en tiempo real.

## 📥 Resultado típico
```text
PORT    STATE SERVICE VERSION
22/tcp  open  ssh     OpenSSH 7.6p1 Ubuntu
25/tcp  open  smtp    Postfix smtpd
80/tcp  open  http    Apache httpd 2.4.29
...
```

## 📡 Packet Tracing (opcional)
```bash
sudo nmap -p- -sV -Pn -n --disable-arp-ping --packet-trace <IP>
```

## 🧪 Captura manual de banners
```bash
# Escucha tráfico
sudo tcpdump -i eth0 host <tu_IP> and <objetivo>

# Conéctate al puerto manualmente
nc -nv <IP_objetivo> 25
```
- Muchos servicios responden con banners tras el handshake.
- El banner suele indicar nombre, versión, incluso SO (`Postfix (Ubuntu)`).

## 🧬 Análisis del tráfico (3-way handshake + banner)
1. **SYN** → Cliente inicia conexión  
2. **SYN-ACK** → Servidor responde  
3. **ACK** → Cliente confirma  
4. **PSH-ACK** → Servidor envía banner  
5. **ACK** → Cliente lo confirma

> Este método expone datos que Nmap a veces no interpreta completamente.

## 📚 Recurso adicional
- [Nmap Service Detection Docs](https://nmap.org/book/man-version-detection.html)


# 🧪 Laboratorio: Enumerar puertos y servicios

## 🎯 Objetivo
Enumerar todos los puertos y servicios del objetivo. Uno de los servicios contiene una flag.

## 🚀 Pasos realizados
```bash
sudo nmap -p- -sV 10.129.105.112 -oA fullscan
```

## 🔍 Acción posterior
Revisar servicios identificados en el escaneo (`fullscan.nmap`) y conectarse al que contenga contenido visible (como HTTP o SMTP).

Usar:
```bash
curl http://10.129.105.112
# o
nc 10.129.105.112 <puerto>
```

## 🏁 Resultado
La flag se encontró directamente en el banner del puerto `31337/tcp`:

```
HTB{pr0F7pDv3r510nb4nn3r}
```

---

## 🧠 Nota técnica sobre flags en banners

En el laboratorio, la flag fue revelada en el banner de un servicio no reconocido por Nmap (`31337/tcp`).

La teoría **no lo dice explícitamente**, pero:

- Enseña a usar `-sV` para obtener banners.
- Muestra ejemplos de servicios que exponen información al conectarse (como SMTP).
- Advierte que algunos servicios no identificados devuelven datos útiles.

✅ **Conclusión**: Este tipo de flag se deduce al combinar lo aprendido sobre *banner grabbing*, *servicios no reconocidos* y *análisis manual del resultado*. 
